# Introducción — De agregado a desagregado: HCP–Brick y MMM→MTA

Este libro parte de una situación muy común en empresas: existe un **agregado observado** (por ejemplo, ventas por brick $y_b$, o contribución incremental por canal $C_{m,t,g}^{inc}$) y, sin embargo, la decisión operativa exige bajar a un nivel más fino (HCPs, campañas, creatividades). El objetivo no es “repartir por repartir”, sino construir un reparto que **conserve masa** (sume exactamente al total), sea **estable y reproducible**, y resulte **interpretable y auditable**.

La clave es reconocer que la atribución que buscamos es una **inferencia** sobre variables que no observamos.

## El patrón general (HCP–Brick y MMM→MTA son el mismo problema)

En todo el libro usamos la misma estructura conceptual. Primero, hay una variable **observada**: un total por “grupo” $b$. En HCP–brick ese total es $y_b$ (ventas o unidades por brick). En MMM→MTA, el análogo es $C_{m,t,g}$ o $C_{m,t,g}^{inc}$ (contribución por medio $m$, tiempo $t$ y geo $g$).

Segundo, existe una capa **latente**: contribuciones individuales que, al agregarse, recuperan exactamente el total observado. En HCP–brick denotamos estas contribuciones por $z_{h,b}$; en MMM→MTA, por $z_{m,k,t,g}$.

Tercero, el reparto está controlado por una noción de **productividad/eficiencia**, un parámetro positivo que determina cómo se distribuye el total entre unidades: $\lambda_h$ para HCPs o $\lambda_{m,k}$ para campañas dentro de un medio. En modelos más realistas, esa productividad se parametriza como $\lambda=\exp(X\beta)$ para compartir información y controlar overfitting.

Por último, el modelo incorpora un término de **exposición/oportunidad**, conocido, que modula el volumen esperable. En HCP–brick lo representamos como $w_{h,b}$ (o, si se prefiere, $\omega_{b,h}$); en MMM→MTA aparece como $w_{m,k,t,g}$ (por ejemplo spend/impresiones), potencialmente transformado mediante adstock y saturación.

Para la nomenclatura técnica y la distinción entre *exposure* y *offset* (y su interpretación en este libro), véase el [Ap-3 — Exposición y offset: nomenclatura e interpretación](93-ap-3-exposure.qmd).

En forma canónica (para unidades), el modelo típico es:

$$
z_{h,b} \sim \text{Poisson}(\lambda_h\,w_{h,b})
\quad\text{y}\quad
y_b = \sum_h z_{h,b}.
$$

Para euros (continuo), usamos variantes tipo Gamma (y discutimos riesgos con Lognormal).

## Qué hace EM en este libro

EM alterna dos pasos. En el *E-step*, con la productividad fija, calcula el reparto esperado dentro de cada grupo (shares), garantizando por construcción la conservación de masa, es decir, $\sum_h \hat z_{h,b}=y_b$. En el *M-step*, con $\hat z$ fijo, actualiza la productividad (o los coeficientes $\beta$ si hay covariables), típicamente como un GLM con offset y regularización.

En producción, el output útil suele ser la atribución esperada $\hat z$ y una estimación de productividad $\hat\lambda$ (útil como ranking o eficiencia relativa, a veces normalizada). Además, siempre acompañamos el resultado con checks de estabilidad e identificabilidad: si esos checks no son razonables, el output no es defendible.

## Nota importante sobre causalidad

Este marco es principalmente **credit allocation model-based**.

Si el total observado proviene de un MMM incremental/causal, entonces el **total** es incremental. El reparto intra-canal (campañas/creatividades), en cambio, no es automáticamente causal: necesita identificación adicional (features fuertes, experimentos, restricciones, priors jerárquicos, etc.).

## Qué encontrarás más adelante

El recorrido empieza con el caso base (sin covariables) y progresa hacia un modelo realista con GLM y regularización. A lo largo del camino se introduce un generador de datos mock para evaluar recuperación y hacer *stress testing*, una implementación práctica en Python, y un caso de uso MMM→MTA (incluyendo un notebook donde la exposición efectiva incorpora adstock y saturación). El tramo final está dedicado a criterio de producción: pitfalls, cómo explicarlo a negocio y una alternativa bayesiana.

Como material reutilizable para comunicación, el libro incluye el [Ap-2 — Whitepaper para CXOs (EN)](92-ap-2-doc-CXOs.qmd) y dos piezas breves: [Blog post (CMO)](94-blog_post_CMO.qmd) y [Blog post (Head of Data Science)](95-blog-post-DS.qmd).
