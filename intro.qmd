# Introducción

Este libro parte de una situación muy común en empresas:

- Tenemos un **agregado observado** (p. ej., ventas por brick $y_b$, o contribución incremental por canal $C_{m,t,g}^{inc}$).
- Queremos asignar ese total a unidades más finas (HCPs, campañas, creatividades) de forma que:

	- conserve masa (sume exactamente al total),
	- sea estable/reproducible,
	- sea interpretable y auditable.

La clave es reconocer que la atribución que buscamos es una **inferencia** sobre variables que no observamos.

## El patrón general (HCP–Brick y MMM→MTA son el mismo problema)

En todo el libro usamos la misma estructura conceptual:

- **Observado**: un total por “grupo” $b$.

	- En HCP–Brick: $y_b$ (ventas/unidades por brick).
	- En MMM→MTA: $C_{m,t,g}$ o $C_{m,t,g}^{inc}$ (contribución por medio, tiempo y geo).

- **Latente**: contribuciones individuales que suman al total.

	- En HCP–Brick: $z_{h,b}$.
	- En MMM→MTA: $z_{m,k,t,g}$.

- **Productividad / eficiencia**: un parámetro positivo que controla el reparto.

	- $\lambda_h$ (HCP) o $\lambda_{m,k}$ (campaña dentro de medio).
	- En modelos realistas: $\lambda=\exp(X\beta)$ para compartir información y controlar overfitting.

- **Exposición / oportunidad**: un término conocido que modula el volumen esperable.

	- $\omega_{b,h}$ o $w_{h,b}$ en HCP–Brick.
	- $w_{m,k,t,g}$ en MMM→MTA (p. ej. spend/impresiones), potencialmente transformado con adstock + saturación.

En forma canónica (para unidades), el modelo típico es:

$$
z_{i,b} \sim \text{Poisson}(\lambda_i\,\omega_{b,i})
\quad\text{y}\quad
y_b = \sum_i z_{i,b}.
$$

Para euros (continuo), usamos variantes tipo Gamma (y discutimos riesgos con Lognormal).

## Qué hace EM en este libro

EM alterna dos pasos:

- **E-step**: con $\lambda$ fijo, calcula el reparto esperado dentro de cada grupo (shares), garantizando $\sum_i \hat z_{i,b}=y_b$.
- **M-step**: con $\hat z$ fijo, actualiza $\lambda$ (o $\beta$ si hay covariables), típicamente como un GLM con offset y regularización.

El output útil en producción suele ser:

- $\hat z$ (atribución esperada)
- $\hat\lambda$ (ranking/eficiencia relativa; a veces normalizada)
- checks de estabilidad y de identificabilidad (si no son razonables, el output no es defendible).

## Nota importante sobre causalidad

Este marco es principalmente **credit allocation model-based**.

- Si el total observado proviene de un MMM incremental/causal, entonces el **total** es incremental.
- El reparto intra-canal (campañas/creatividades) no es automáticamente causal: necesita identificación adicional (features fuertes, experimentos, restricciones, priors jerárquicos, etc.).

## Qué encontrarás más adelante

- Un recorrido desde el caso base (sin covariables) hasta un modelo realista con GLM + regularización.
- Un generador de datos mock para evaluar recuperación y stress testing.
- Implementación práctica en Python.
- Un caso de uso MMM→MTA y un notebook donde la exposición efectiva incorpora adstock + saturación.
- Capítulos de criterio senior: pitfalls, cómo explicarlo a negocio, y alternativa bayesiana.
